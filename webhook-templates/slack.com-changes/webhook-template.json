{"id":"slack.com-changes","description":"Slack.com with Changes","status":"USER_DEFINED","format":"jsonVelocityTemplate","rank":100,"href":"/app/rest/webhooks/templates/id:slack.com-changes","defaultTemplate":{"id":"defaultTemplate","href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate","templateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/templateContent","content":"{  \n    \"username\": \"TeamCity\",\n    \"icon_url\" : \"https://raw.githubusercontent.com/tcplugins/tcWebHooks/master/docs/icons/teamcity-logo-48x48.png\",\n    \"attachments\": [ \n        { \n            \"title\": \"#capitalise(${buildStateDescription}) : ${buildName} <${buildStatusUrl}|build #${buildNumber}>\",\n            \"fallback\": \"#capitalise(${buildStateDescription}) : ${buildName} build #${buildNumber}\", \n            \"fields\" : [\n                { \"title\" : \"Status\", \"value\" : \"${buildStatus} (${buildStateDescription})\" },\n                { \"title\" : \"Project Name\", \"value\" : \"<${rootUrl}/project.html?projectId=${projectExternalId}|${projectName}>\", \"short\": true },\n                { \"title\" : \"Build Name\", \"value\" : \"<${rootUrl}/viewType.html?buildTypeId=${buildExternalTypeId}|${buildName}>\", \"short\": true },\n                { \"title\" : \"Agent\", \"value\" : \"${agentName}\", \"short\" : true },\n                { \"title\" : \"Triggered By\", \"value\" : \"${triggeredBy}\", \"short\" : true }\n            ]\n        }\n    ]\n}","useTemplateTextForBranch":false},"branchTemplateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/branchTemplateContent","content":"{  \n    \"username\": \"TeamCity\",\n    \"icon_url\" : \"https://raw.githubusercontent.com/tcplugins/tcWebHooks/master/docs/icons/teamcity-logo-48x48.png\",\n    \"attachments\": [ \n        { \n            \"title\": \"#capitalise(${buildStateDescription}) : ${buildName} [${branchDisplayName}] <${buildStatusUrl}|build #${buildNumber}>\",\n            \"fallback\": \"#capitalise(${buildStateDescription}) : ${buildName} [${branchDisplayName}] build #${buildNumber}\", \n            \"fields\" : [\n                { \"title\" : \"Status\", \"value\" : \"${buildStatus} (${buildStateDescription})\" },\n                { \"title\" : \"Project Name\", \"value\" : \"<${rootUrl}/project.html?projectId=${projectExternalId}|${projectName}>\", \"short\": true },\n                { \"title\" : \"Build Name\", \"value\" : \"<${rootUrl}/viewType.html?buildTypeId=${buildExternalTypeId}|${buildName}>\", \"short\": true },\n                { \"title\" : \"Branch\", \"value\" : \"${branchDisplayName}\", \"short\": true },\n                { \"title\" : \"Commit\", \"value\" : \"<${buildStatusUrl}&tab=buildChangesDiv|#substr(${build_vcs_number},0,7,32)>\", \"short\": true },\n                { \"title\" : \"Triggered By\", \"value\" : \"${triggeredBy}\", \"short\" : true },\n                { \"title\" : \"Agent\", \"value\" : \"${agentName}\", \"short\" : true }\n            ]\n        }\n    ]\n}"},"buildState":[{"type":"buildAddedToQueue","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildAddedToQueue"},{"type":"buildRemovedFromQueue","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildRemovedFromQueue"},{"type":"buildStarted","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildStarted"},{"type":"changesLoaded","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/changesLoaded"},{"type":"buildInterrupted","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildInterrupted"},{"type":"beforeBuildFinish","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/beforeBuildFinish"},{"type":"buildSuccessful","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildSuccessful"},{"type":"buildFailed","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildFailed"},{"type":"buildFixed","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildFixed"},{"type":"buildBroken","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildBroken"},{"type":"responsibilityChanged","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/responsibilityChanged"},{"type":"buildPinned","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildPinned"},{"type":"buildUnpinned","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/defaultTemplate/buildStates/buildUnpinned"}]},"preferredDateFormat":"","toolTip":"Message Slack with User changes","templateItem":[{"id":"4","href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4","templateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/templateContent","content":"## Define macro called \"resolveSlackUid\"\n## If username not found in parameter slackMapping, then just return the username from the commit\n#macro( resolveSlackUid $myUserName)\n#set ($uidMap = $jsonTool.jsonToMap($slackMapping))\n#if( $uidMap.get($myUserName) )<@$uidMap.get($myUserName)>#else<@$myUserName>#end\n#end\n## Define macro called \"showchanges\"\n#macro( showchanges $mychanges )\n#if ( $mychanges.size() > 0 ) \n#foreach( $change in $mychanges )\nâ€¢ #substr($change.version,0,7,32) :: #resolveSlackUid($change.change.username) :: #escapejson($change.change.comment.split(\"\\n\").get(0))\\n\n#end\n#else No Changes found #end\n#end\n## Define macro to resolve status\n#macro( resolveStatus)\n#set( $resultsMap = { \"BUILD_SUCCESSFUL\" : \"Success\", \"BUILD_FAILED\" : \"Failed\", \"BUILD_FIXED\" : \"Success (fixed)\", \"BUILD_BROKEN\" : \"Failed (broken)\" } )\n#if($resultsMap.containsKey(${derivedBuildEventType}))$resultsMap.get(${derivedBuildEventType})#else#capitalise(${buildStateDescription})#end\n#end\n#macro( getCommitInfo )\n#if(${build_vcs_number})#substr(${build_vcs_number},0,7,32)#else None #end\n#end\n## Define color map\n#set( $colorMap = { \"success\" : \"good\", \"failure\" : \"danger\" } )\n{  \n    \"username\": \"TeamCity\",\n    \"icon_url\" : \"https://raw.githubusercontent.com/tcplugins/tcWebHooks/master/docs/icons/teamcity-logo-48x48.png\",\n    \"attachments\": [ \n        { \n            \"title\": \"#resolveStatus() : ${buildName} <${buildStatusUrl}|build #${buildNumber}>\", \n            \"fallback\": \"#resolveStatus() : ${buildName} build #${buildNumber}\", \n            #if($colorMap.containsKey(${buildResult})) \"color\": \"$colorMap.get(${buildResult})\", #end\n            \"fields\" : [\n                { \"title\" : \"Status\", \"value\" : \"${buildStatus}\" },\n                { \"title\" : \"Project Name\", \"value\" : \"<${rootUrl}/project.html?projectId=${projectExternalId}|${projectName}>\", \"short\": true },\n                { \"title\" : \"Build Name\", \"value\" : \"<${rootUrl}/viewType.html?buildTypeId=${buildExternalTypeId}|${buildName}>\", \"short\": true },\n                #if(${branchDisplayName}){ \"title\" : \"Branch\", \"value\" : \"${branchDisplayName}\", \"short\": true },#end\n                { \"title\" : \"Commit\", \"value\" : \"<${buildStatusUrl}&tab=buildChangesDiv|#getCommitInfo()>\", \"short\": true },\n                { \"title\" : \"Triggered By\", \"value\" : \"${triggeredBy}\", \"short\" : true },\n                { \"title\" : \"Agent\", \"value\" : \"${agentName}\", \"short\" : true },\n                { \"title\" : \"Changes-xx\", \"value\" : \"#showchanges( $changes )\"}\n            ]\n        }\n    ]\n}","useTemplateTextForBranch":true},"branchTemplateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/branchTemplateContent","content":""},"buildState":[{"type":"buildAddedToQueue","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildAddedToQueue"},{"type":"buildRemovedFromQueue","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildRemovedFromQueue"},{"type":"buildStarted","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildStarted"},{"type":"changesLoaded","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/changesLoaded"},{"type":"buildInterrupted","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildInterrupted"},{"type":"beforeBuildFinish","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/beforeBuildFinish"},{"type":"buildSuccessful","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildSuccessful"},{"type":"buildFailed","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildFailed"},{"type":"buildFixed","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildFixed"},{"type":"buildBroken","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildBroken"},{"type":"responsibilityChanged","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/responsibilityChanged"},{"type":"buildPinned","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildPinned"},{"type":"buildUnpinned","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:4/buildStates/buildUnpinned"}]},{"id":"5","href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5","templateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/templateContent","content":"{  \n    \"username\": \"TeamCity\",\n    \"icon_url\" : \"https://raw.githubusercontent.com/tcplugins/tcWebHooks/master/docs/icons/teamcity-logo-48x48.png\",\n    \"attachments\": [ \n        { \n            \"title\": \"#capitalise(${buildStateDescription}) : ${buildName} <${buildStatusUrl}|build #${buildNumber}>\",\n            \"fallback\": \"#capitalise(${buildStateDescription}) : ${buildName} build #${buildNumber}\", \n            \"fields\" : [\n                { \"title\" : \"Status\", \"value\" : \"${buildStatus} (${buildStateDescription})\" },\n                { \"title\" : \"Project Name\", \"value\" : \"<${rootUrl}/project.html?projectId=${projectExternalId}|${projectName}>\", \"short\": true },\n                { \"title\" : \"Build Name\", \"value\" : \"<${rootUrl}/viewType.html?buildTypeId=${buildExternalTypeId}|${buildName}>\", \"short\": true },\n                { \"title\" : \"Triggered By\", \"value\" : \"${triggeredBy}\", \"short\" : true }\n\n            ]\n        }\n    ]\n}","useTemplateTextForBranch":false},"branchTemplateText":{"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/branchTemplateContent","content":"{  \n    \"username\": \"TeamCity\",\n    \"icon_url\" : \"https://raw.githubusercontent.com/tcplugins/tcWebHooks/master/docs/icons/teamcity-logo-48x48.png\",\n    \"attachments\": [ \n        { \n            \"title\": \"#capitalise(${buildStateDescription}) : ${buildName} [${branchDisplayName}] <${buildStatusUrl}|build #${buildNumber}>\",\n            \"fallback\": \"#capitalise(${buildStateDescription}) : ${buildName} [${branchDisplayName}] build #${buildNumber}\", \n            \"fields\" : [\n                { \"title\" : \"Status\", \"value\" : \"${buildStatus} (${buildStateDescription})\" },\n                { \"title\" : \"Project Name\", \"value\" : \"<${rootUrl}/project.html?projectId=${projectExternalId}|${projectName}>\", \"short\": true },\n                { \"title\" : \"Build Name\", \"value\" : \"<${rootUrl}/viewType.html?buildTypeId=${buildExternalTypeId}|${buildName}>\", \"short\": true },\n                { \"title\" : \"Branch\", \"value\" : \"${branchDisplayName}\", \"short\": true },\n                { \"title\" : \"Commit\", \"value\" : \"<${buildStatusUrl}&tab=buildChangesDiv|#substr(${build_vcs_number},0,7,32)>\", \"short\": true },\n                { \"title\" : \"Triggered By\", \"value\" : \"${triggeredBy}\", \"short\" : true },\n                { \"title\" : \"Agent\", \"value\" : \"${agentName}\", \"short\" : true }\n            ]\n        }\n    ]\n}"},"buildState":[{"type":"buildAddedToQueue","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildAddedToQueue"},{"type":"buildRemovedFromQueue","enabled":true,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildRemovedFromQueue"},{"type":"buildStarted","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildStarted"},{"type":"changesLoaded","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/changesLoaded"},{"type":"buildInterrupted","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildInterrupted"},{"type":"beforeBuildFinish","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/beforeBuildFinish"},{"type":"buildSuccessful","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildSuccessful"},{"type":"buildFailed","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildFailed"},{"type":"buildFixed","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildFixed"},{"type":"buildBroken","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildBroken"},{"type":"responsibilityChanged","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/responsibilityChanged"},{"type":"buildPinned","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildPinned"},{"type":"buildUnpinned","enabled":false,"href":"/app/rest/webhooks/templates/id:slack.com-changes/templateItems/id:5/buildStates/buildUnpinned"}]}]}